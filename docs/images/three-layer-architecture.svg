<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="820" viewBox="0 0 1100 820" font-family="'Segoe UI', Arial, Helvetica, sans-serif">

  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#334155"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#16a34a"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#dc2626"/>
    </marker>
    <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#2563eb"/>
    </marker>
    <marker id="arrow-amber" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#d97706"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1100" height="820" fill="#ffffff"/>

  <!-- Title -->
  <text x="550" y="38" text-anchor="middle" font-size="22" font-weight="700" fill="#0f172a">Three-Layer Control Architecture</text>
  <text x="550" y="60" text-anchor="middle" font-size="13" fill="#64748b">Guardrails prevent · Judge detects · Humans decide</text>

  <!-- ==================== USER INPUT ==================== -->
  <rect x="440" y="85" width="220" height="44" rx="22" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1.5"/>
  <text x="550" y="108" text-anchor="middle" font-size="13" font-weight="600" fill="#475569">User Input</text>
  <line x1="550" y1="129" x2="550" y2="160" stroke="#334155" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- ==================== LAYER 1: GUARDRAILS ==================== -->
  <rect x="80" y="160" width="940" height="155" rx="8" fill="#eff6ff" stroke="#93c5fd" stroke-width="1.5"/>
  <text x="100" y="185" font-size="12" font-weight="700" fill="#1e40af" letter-spacing="1.5">LAYER 1: GUARDRAILS</text>
  <text x="1000" y="185" text-anchor="end" font-size="11" fill="#64748b">Inline · &lt;100ms · Always on</text>

  <!-- Input guardrails -->
  <rect x="120" y="200" width="180" height="48" rx="5" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="210" y="220" text-anchor="middle" font-size="11" font-weight="600" fill="#1e40af">Input Validation</text>
  <text x="210" y="236" text-anchor="middle" font-size="10" fill="#64748b">Length · encoding · injection</text>

  <rect x="320" y="200" width="180" height="48" rx="5" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="410" y="220" text-anchor="middle" font-size="11" font-weight="600" fill="#1e40af">Topic Restriction</text>
  <text x="410" y="236" text-anchor="middle" font-size="10" fill="#64748b">Scope from declaration</text>

  <rect x="520" y="200" width="180" height="48" rx="5" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="610" y="220" text-anchor="middle" font-size="11" font-weight="600" fill="#1e40af">PII Detection</text>
  <text x="610" y="236" text-anchor="middle" font-size="10" fill="#64748b">Redact · flag · block</text>

  <rect x="720" y="200" width="180" height="48" rx="5" fill="#ffffff" stroke="#93c5fd" stroke-width="1"/>
  <text x="810" y="220" text-anchor="middle" font-size="11" font-weight="600" fill="#1e40af">Schema Enforcement</text>
  <text x="810" y="236" text-anchor="middle" font-size="10" fill="#64748b">Output format validation</text>

  <!-- Guardrail outcomes -->
  <text x="120" y="278" font-size="11" fill="#475569">Outcome:</text>
  <rect x="195" y="264" width="70" height="22" rx="4" fill="#f0fdf4" stroke="#86efac" stroke-width="1"/>
  <text x="230" y="279" text-anchor="middle" font-size="10" font-weight="600" fill="#166534">PASS</text>
  <rect x="280" y="264" width="70" height="22" rx="4" fill="#fef2f2" stroke="#fca5a5" stroke-width="1"/>
  <text x="315" y="279" text-anchor="middle" font-size="10" font-weight="600" fill="#991b1b">BLOCK</text>
  <rect x="365" y="264" width="70" height="22" rx="4" fill="#fefce8" stroke="#fde047" stroke-width="1"/>
  <text x="400" y="279" text-anchor="middle" font-size="10" font-weight="600" fill="#854d0e">FLAG</text>

  <text x="480" y="278" font-size="11" fill="#475569">Blocked → logged + cost event. Flagged → continue + alert. Pass → proceed to model.</text>

  <!-- Arrow from guardrails to model -->
  <line x1="550" y1="315" x2="550" y2="340" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrow-green)"/>
  <text x="560" y="332" font-size="10" fill="#16a34a">Pass</text>

  <!-- Block arrow out to the right -->
  <line x1="920" y1="240" x2="970" y2="240" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arrow-red)"/>
  <rect x="975" y="226" width="70" height="28" rx="4" fill="#fef2f2" stroke="#fca5a5" stroke-width="1"/>
  <text x="1010" y="240" text-anchor="middle" font-size="10" font-weight="600" fill="#dc2626">Block</text>
  <text x="1010" y="251" text-anchor="middle" font-size="8" fill="#64748b">Log + charge</text>

  <!-- ==================== MODEL ==================== -->
  <rect x="420" y="340" width="260" height="48" rx="6" fill="#1e40af" stroke="#1e3a8a" stroke-width="1.5"/>
  <text x="550" y="362" text-anchor="middle" font-size="14" font-weight="700" fill="#ffffff">AI Model</text>
  <text x="550" y="378" text-anchor="middle" font-size="11" fill="#bfdbfe">Generates response</text>

  <!-- Arrow from model to output guardrails -->
  <line x1="550" y1="388" x2="550" y2="413" stroke="#334155" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Output guardrails bar -->
  <rect x="300" y="413" width="500" height="32" rx="5" fill="#eff6ff" stroke="#93c5fd" stroke-width="1.5"/>
  <text x="550" y="434" text-anchor="middle" font-size="12" font-weight="600" fill="#1e40af">Output Guardrails — PII redaction · toxicity check · schema validation</text>

  <!-- Arrow to user -->
  <line x1="550" y1="445" x2="550" y2="470" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arrow-green)"/>

  <!-- Response delivered -->
  <rect x="440" y="470" width="220" height="44" rx="22" fill="#f0fdf4" stroke="#86efac" stroke-width="1.5"/>
  <text x="550" y="493" text-anchor="middle" font-size="13" font-weight="600" fill="#166534">Response Delivered</text>

  <!-- ==================== LAYER 2: JUDGE ==================== -->
  <!-- Sampling arrow from response -->
  <line x1="660" y1="492" x2="740" y2="492" stroke="#2563eb" stroke-width="1.5" stroke-dasharray="5,3"/>
  <line x1="740" y1="492" x2="740" y2="545" stroke="#2563eb" stroke-width="1.5" marker-end="url(#arrow-blue)"/>
  <text x="700" y="520" font-size="10" fill="#2563eb" transform="rotate(90, 700, 520)">Sample</text>

  <rect x="80" y="545" width="940" height="115" rx="8" fill="#faf5ff" stroke="#c4b5fd" stroke-width="1.5"/>
  <text x="100" y="570" font-size="12" font-weight="700" fill="#6d28d9" letter-spacing="1.5">LAYER 2: LLM-AS-JUDGE</text>
  <text x="1000" y="570" text-anchor="end" font-size="11" fill="#64748b">Async or inline · 5–100% by tier</text>

  <rect x="120" y="585" width="200" height="48" rx="5" fill="#ffffff" stroke="#c4b5fd" stroke-width="1"/>
  <text x="220" y="605" text-anchor="middle" font-size="11" font-weight="600" fill="#6d28d9">Factual Grounding</text>
  <text x="220" y="621" text-anchor="middle" font-size="10" fill="#64748b">Hallucination detection</text>

  <rect x="340" y="585" width="200" height="48" rx="5" fill="#ffffff" stroke="#c4b5fd" stroke-width="1"/>
  <text x="440" y="605" text-anchor="middle" font-size="11" font-weight="600" fill="#6d28d9">Scope Compliance</text>
  <text x="440" y="621" text-anchor="middle" font-size="10" fill="#64748b">Behaviour vs declaration</text>

  <rect x="560" y="585" width="200" height="48" rx="5" fill="#ffffff" stroke="#c4b5fd" stroke-width="1"/>
  <text x="660" y="605" text-anchor="middle" font-size="11" font-weight="600" fill="#6d28d9">Policy Compliance</text>
  <text x="660" y="621" text-anchor="middle" font-size="10" fill="#64748b">Regulatory + brand rules</text>

  <rect x="780" y="585" width="200" height="48" rx="5" fill="#ffffff" stroke="#c4b5fd" stroke-width="1"/>
  <text x="880" y="605" text-anchor="middle" font-size="11" font-weight="600" fill="#6d28d9">Manipulation</text>
  <text x="880" y="621" text-anchor="middle" font-size="10" fill="#64748b">Injection · jailbreak</text>

  <!-- Arrow from Judge to findings -->
  <line x1="550" y1="660" x2="550" y2="690" stroke="#334155" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="560" y="680" font-size="10" fill="#64748b">Findings</text>

  <!-- ==================== LAYER 3: HUMAN OVERSIGHT ==================== -->
  <rect x="80" y="690" width="940" height="85" rx="8" fill="#fefce8" stroke="#fde047" stroke-width="1.5"/>
  <text x="100" y="715" font-size="12" font-weight="700" fill="#854d0e" letter-spacing="1.5">LAYER 3: HUMAN OVERSIGHT</text>
  <text x="1000" y="715" text-anchor="end" font-size="11" fill="#64748b">Decides and acts on findings</text>

  <rect x="120" y="730" width="180" height="32" rx="5" fill="#ffffff" stroke="#fde047" stroke-width="1"/>
  <text x="210" y="751" text-anchor="middle" font-size="11" font-weight="600" fill="#854d0e">Batch Review</text>

  <rect x="320" y="730" width="180" height="32" rx="5" fill="#ffffff" stroke="#fde047" stroke-width="1"/>
  <text x="410" y="751" text-anchor="middle" font-size="11" font-weight="600" fill="#854d0e">Escalation Triage</text>

  <rect x="520" y="730" width="180" height="32" rx="5" fill="#ffffff" stroke="#fde047" stroke-width="1"/>
  <text x="610" y="751" text-anchor="middle" font-size="11" font-weight="600" fill="#854d0e">Investigation</text>

  <rect x="720" y="730" width="180" height="32" rx="5" fill="#ffffff" stroke="#fde047" stroke-width="1"/>
  <text x="810" y="751" text-anchor="middle" font-size="11" font-weight="600" fill="#854d0e">Remediation</text>

  <!-- Footer -->
  <text x="550" y="805" text-anchor="middle" font-size="11" fill="#94a3b8">AI Security Reference Architecture — Three-Layer Control Model</text>

</svg>
